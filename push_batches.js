const { execSync } = require('child_process');
const fs = require('fs');

const targetDir = './images/projects';

console.log("üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏¢‡∏≠‡∏¢‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...");

// 1. ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å Commit ‡∏Å‡πâ‡∏≠‡∏ô‡∏¢‡∏±‡∏Å‡∏©‡πå 5.6GB ‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏Å‡πâ‡∏≠‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏≠‡∏µ‡∏Å)
try {
    console.log("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Å‡πâ‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà...");
    execSync('git reset HEAD~1'); 
} catch(e) {
    try { execSync('git reset'); } catch(err) {}
}

// 2. ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
const files = fs.readdirSync(targetDir).filter(f => f !== '.DS_Store');
const chunkSize = 200; // ‡πÅ‡∏ö‡πà‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡∏•‡∏∞ 200 ‡∏£‡∏π‡∏õ (‡∏£‡∏≠‡∏ö‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 150MB ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏£‡∏±‡∏ö‡πÑ‡∏´‡∏ß‡∏™‡∏ö‡∏≤‡∏¢‡πÜ)

console.log(`\nüìÅ ‡∏û‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${files.length} ‡∏£‡∏π‡∏õ`);
console.log(`‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô ${Math.ceil(files.length / chunkSize)} ‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î\n`);

// 3. ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ó‡∏¢‡∏≠‡∏¢‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
for (let i = 0; i < files.length; i += chunkSize) {
    const chunk = files.slice(i, i + chunkSize);
    const round = Math.floor(i / chunkSize) + 1;

    console.log(`‚è≥ [‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${round}] ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà ${i + 1} ‡∏ñ‡∏∂‡∏á ${Math.min(i + chunkSize, files.length)}...`);

    // ‡πÅ‡∏≠‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Ç‡πâ‡∏≤ Git ‡∏ó‡∏µ‡∏•‡∏∞‡∏£‡∏π‡∏õ
    for (let file of chunk) {
        try {
            execSync(`git add "${targetDir}/${file}"`);
        } catch(e) {}
    }

    // ‡∏™‡∏±‡πà‡∏á Commit ‡πÅ‡∏•‡∏∞ Push ‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
    try {
        execSync(`git commit -m "Upload batch ${round}"`);
        console.log(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏±‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô GitHub...`);
        execSync(`git push`);
        console.log(`‚úÖ ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${round} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n`);
    } catch (error) {
        console.log(`‚ö†Ô∏è ‡∏Ç‡πâ‡∏≤‡∏°‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${round} (‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢)`);
    }
}

console.log("üéâ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏°‡∏î‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô! ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡∏∂‡πâ‡∏ô GitHub ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö!");